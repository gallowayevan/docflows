!function(){"use strict";function e(e,t){e.each(function(){for(var e,a=d3.select(this),n=a.text().split(/\s+/).reverse(),s=[],c=0,i=a.attr("y"),l=a.attr("x")||0,o=parseFloat(a.attr("dy"))||0,r=a.text(null).append("tspan").attr("x",l).attr("y",i).attr("dy",o+"em");n.length;)e=n.pop(),s.push(e),r.text(s.join(" ")),r.text().length>t&&(s.pop(),r.text(s.join(" ")),s=[e],r=a.append("tspan").attr("x",l).attr("y",i).attr("dy",1.1*++c+o+"em").text(e))})}function t(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var a=e.indexOf("rv:");return parseInt(e.substring(a+3,e.indexOf(".",a)),10)}var n=e.indexOf("Edge/");return n>0&&parseInt(e.substring(n+5,e.indexOf(".",n)),10)}function a(e,t,a){var n=e||"",s=1==p.physicianCode?"resident":"physician";switch(1!=t&&(s+="s"),p.calculation){case"net":0==t?n="Net migration of "+s+" between "+e+" and "+p.stateName+" was 0":t<0?(t=Math.abs(t),n=p.stateName+" was a net exporter of "+a(t)+" "+s+" to "+e):t>0&&(n=p.stateName+" was a net importer of "+a(t)+" "+s+" from "+e);break;case"netToAll":0==t?n=e+"'s net migration of "+s+" was 0":t<0?n=e+" was a net exporter of "+a(t=Math.abs(t))+" "+s:t>0&&(n=e+" was a net importer of "+a(t)+" "+s);break;case"import":n=p.stateName+" imported "+a(t)+" "+s+" from "+e;break;case"export":n=p.stateName+" exported "+a(t)+" "+s+" to "+e;break;case"retention":n=e+" retained "+a(t)+" "+s}return n}function n(){var e,t=p.specialtyName.toLowerCase();switch(""+p.physicianCode+p.calculation){case"1net":e="To which states is "+p.stateName+" a <span style='color:#5e3c99'>net importer</span> or <span style='color:#e66101'>net exporter</span> of residents?";break;case"2net":e="To which states is "+p.stateName+" a <span style='color:#5e3c99'>net importer</span> or <span style='color:#e66101'>net exporter</span> of physicians?";break;case"1netToAll":e="Which states are <span style='color:#5e3c99'>net importers</span> or <span style='color:#e66101'>net exporters</span> of residents?";break;case"2netToAll":e="Which states are <span style='color:#5e3c99'>net importers</span> or <span style='color:#e66101'>net exporters</span> of physicians?";break;case"1import":e="Who is training "+p.stateName+"'s physicians in "+t+"?";break;case"2import":e="Where is "+p.stateName+" importing physicians in "+t+" from?";break;case"1export":e="Where is "+p.stateName+" exporting residents in "+t+" to?";break;case"2export":e="Where is "+p.stateName+" exporting physicians in "+t+" to?";break;case"1retention":e="How well does each state retain its residents?";break;case"2retention":e="How well does each state retain its physicians?"}document.getElementById("map-title").innerHTML=e,s()}function s(){var e=p.data.filter(function(e){return+e.stateID!=+p.stateID}),t=e[0];e.forEach(function(e){Math.abs(e.measure)>Math.abs(t.measure)&&(t=e)});var a=d3.format(","),n=t.measure,s=t.stateName,c=a(Math.abs(t.count)),i=p.specialtyName.toLowerCase(),l=p.data.filter(function(e){return+e.stateID==+p.stateID}),o=a(Math.round(l[0].count/(l[0].measure/100))),r=a(l[0].count),d=l[0].measure+"%";"net"!=p.calculation&&"netToAll"!=p.calculation?n+="%":i="all specialties";var h="contributed",m="received",g="to",u="from";n<0&&"net"==p.calculation&&(h="received",m="contributed",g="from",u="to");var y="Notes";switch(y="<h6><strong>"+y+"</strong></h6>",""+p.physicianCode+p.calculation){case"1net":y+="<p>The current map and chart show the net migration (imports - exports) of doctors who were residents in 2009 and who were practicing",y+=" physicians in 2015 for <span class='changing-text'>"+p.stateName+"</span> relative to each other state.</p>",y+="<p>For instance, <span class='changing-text'>"+s+"</span> "+h+" <span class='changing-text'>"+c+"</span> more 2009",y+=" residents "+g+" <span class='changing-text'>"+p.stateName+"</span>",y+=" than they "+m+" "+u+" <span class='changing-text'>"+p.stateName+"</span>.</p>";break;case"2net":y+="<p>The current map and chart show the net migration (imports - exports) of physicians who were actively practicing in 2009 and 2015",y+=" for <span class='changing-text'>"+p.stateName+"</span> relative to each other state.</p>",y+="<p>For instance, <span class='changing-text'>"+s+"</span> "+h+" <span class='changing-text'>"+c+"</span> more",y+=" physicians "+g+" <span class='changing-text'>"+p.stateName+"</span>",y+=" than they "+m+" "+u+" <span class='changing-text'>"+p.stateName+"</span>.</p>";break;case"1netToAll":y+="<p>The current map and chart show the net migration (imports - exports) of doctors who were residents in 2009 and who were practicing",y+=" physicians in 2015 for each state relative to all other states in aggregate.</p>",y+="<p>For instance, <span class='changing-text'>"+s+"</span> received <span class='changing-text'>"+c+"</span> more 2009 residents",y+=" from all other states than they contributed.</p>";break;case"2netToAll":y+="<p>The current map and chart show the net migration (imports - exports) of physicians who were actively practicing in 2009 and 2015",y+=" for each state relative to all other states in aggregate.</p>",y+="<p>For instance, <span class='changing-text'>"+s+"</span> received <span class='changing-text'>"+c+"</span> more physicians",y+=" from all other states than they contributed.</p>";break;case"1import":y+="<p>The current map and chart show the percentage of 2009 residents in <span class='changing-text'>"+i+"</span> who were practicing in",y+=" <span class='changing-text'>"+p.stateName+"</span> in 2015 but who were training in another state in 2009.</p>",y+="<p>For instance, of the <span class='changing-text'>"+o+"</span> physicians in <span class='changing-text'>"+i+"</span> who were in training in 2009 and actively practicing in <span class='changing-text'>"+p.stateName+"</span> in 2015,",y+=" <span class='changing-text'>"+c+"</span> were residents in <span class='changing-text'>"+s+"</span> in 2009, which is <span class='changing-text'>"+n+"</span>",y+="  (<span class='changing-text'>"+c+"</span> / <span class='changing-text'>"+o+"</span> * 100). This percentage is the mapped and charted value.</p>";break;case"2import":y+="<p>The current map and chart show the percentage of physicians in <span class='changing-text'>"+i+"</span> who were practicing in another state in 2009",y+=" and who were practicing in <span class='changing-text'>"+p.stateName+"</span> in 2015 as a percent of the total number of physicians in <span class='changing-text'>"+p.stateName+"</span> who were actively practicing in 2009 and 2015.</p>",y+="<p>For instance, of the <span class='changing-text'>"+o+"</span> physicians in <span class='changing-text'>"+i+"</span> in <span class='changing-text'>"+p.stateName+"</span> who were actively practicing in 2009 and 2015,",y+=" <span class='changing-text'>"+c+"</span> were practicing in <span class='changing-text'>"+s+"</span> in 2009, which is <span class='changing-text'>"+n+"</span>",y+="  (<span class='changing-text'>"+c+"</span> / <span class='changing-text'>"+o+"</span> * 100). This percentage is the mapped and charted value.</p>";break;case"1export":y+="<p>The current map and chart show the percentage of residents in <span class='changing-text'>"+i+"</span> who were training",y+=" in <span class='changing-text'>"+p.stateName+"</span> in 2009 but who were practicing physicians in another state in 2015 as a percent of the total number",y+=" of residents training in <span class='changing-text'>"+p.stateName+"</span> in 2009.</p>",y+="<p>For instance, of the <span class='changing-text'>"+o+"</span> residents in <span class='changing-text'>"+i+"</span> in <span class='changing-text'>"+p.stateName+"</span> in 2009 who were also active physicians in 2015,",y+=" <span class='changing-text'>"+c+"</span> were practicing physicians in <span class='changing-text'>"+s+"</span> in 2015, which is <span class='changing-text'>"+n+"</span>",y+="  (<span class='changing-text'>"+c+"</span> / <span class='changing-text'>"+o+"</span> * 100). This percentage is the mapped and charted value.</p>";break;case"2export":y+="<p>The current map and chart show the percentage of physicians in <span class='changing-text'>"+i+"</span> who were practicing",y+=" in <span class='changing-text'>"+p.stateName+"</span> in 2009 but who were practicing physicians in another state in 2015 as a percent of the total number",y+=" of physicians in <span class='changing-text'>"+i+"</span> active in <span class='changing-text'>"+p.stateName+"</span> in 2009.</p>",y+="<p>For instance, of the <span class='changing-text'>"+o+"</span> physicians in <span class='changing-text'>"+i+"</span> in <span class='changing-text'>"+p.stateName+"</span> in 2009 who were also active physicians in 2015,",y+=" <span class='changing-text'>"+c+"</span> were practicing in <span class='changing-text'>"+s+"</span> in 2015, which is <span class='changing-text'>"+n+"</span>",y+="  (<span class='changing-text'>"+c+"</span> / <span class='changing-text'>"+o+"</span> * 100). This percentage is the mapped and charted value.</p>";break;case"1retention":y+="<p>The current map and chart show the percentage of residents in <span class='changing-text'>"+i+"</span> who were training",y+=" in a given state in 2009 and who were practicing physicians in the same state in 2015 as a percent of the total number",y+=" of residents trained in each state in 2009.</p>",y+="<p>For instance, of the <span class='changing-text'>"+o+"</span> residents in <span class='changing-text'>"+i+"</span> in <span class='changing-text'>"+p.stateName+"</span> in 2009,",y+=" <span class='changing-text'>"+r+"</span> were practicing in <span class='changing-text'>"+p.stateName+"</span> in 2015, which is <span class='changing-text'>"+d+"</span>",y+="  (<span class='changing-text'>"+r+"</span> / <span class='changing-text'>"+o+"</span> * 100). This percentage is the mapped and charted value.</p>";break;case"2retention":y+="<p>The current map and chart show the percentage of physicians in <span class='changing-text'>"+i+"</span> who were practicing",y+=" in a given state in 2009 and who were practicing in the same state in 2015 as a percent of the total number",y+=" of active physicians in each state in 2009.</p>",y+="<p>For instance, of the <span class='changing-text'>"+o+"</span> physicians in <span class='changing-text'>"+i+"</span> in <span class='changing-text'>"+p.stateName+"</span> in 2009,",y+=" <span class='changing-text'>"+r+"</span> were still practicing in <span class='changing-text'>"+p.stateName+"</span> in 2015, which is <span class='changing-text'>"+d+"</span>",y+="  (<span class='changing-text'>"+r+"</span> / <span class='changing-text'>"+o+"</span> * 100). This percentage is the mapped and charted value.</p>"}d3.select("#help-box").html(y)}var c=d3.dispatch("dataReady","stateChange","colorScaleReady"),i=d3.format("02"),l={1:{name:"Alabama",code:"AL"},2:{name:"Alaska",code:"AK"},4:{name:"Arizona",code:"AZ"},5:{name:"Arkansas",code:"AR"},6:{name:"California",code:"CA"},8:{name:"Colorado",code:"CO"},9:{name:"Connecticut",code:"CT"},10:{name:"Delaware",code:"DE"},11:{name:"District of Columbia",code:"DC"},12:{name:"Florida",code:"FL"},13:{name:"Georgia",code:"GA"},15:{name:"Hawaii",code:"HI"},16:{name:"Idaho",code:"ID"},17:{name:"Illinois",code:"IL"},18:{name:"Indiana",code:"IN"},19:{name:"Iowa",code:"IA"},20:{name:"Kansas",code:"KS"},21:{name:"Kentucky",code:"KY"},22:{name:"Louisiana",code:"LA"},23:{name:"Maine",code:"ME"},24:{name:"Maryland",code:"MD"},25:{name:"Massachusetts",code:"MA"},26:{name:"Michigan",code:"MI"},27:{name:"Minnesota",code:"MN"},28:{name:"Mississippi",code:"MS"},29:{name:"Missouri",code:"MO"},30:{name:"Montana",code:"MT"},31:{name:"Nebraska",code:"NE"},32:{name:"Nevada",code:"NV"},33:{name:"New Hampshire",code:"NH"},34:{name:"New Jersey",code:"NJ"},35:{name:"New Mexico",code:"NM"},36:{name:"New York",code:"NY"},37:{name:"North Carolina",code:"NC"},38:{name:"North Dakota",code:"ND"},39:{name:"Ohio",code:"OH"},40:{name:"Oklahoma",code:"OK"},41:{name:"Oregon",code:"OR"},42:{name:"Pennsylvania",code:"PA"},44:{name:"Rhode Island",code:"RI"},45:{name:"South Carolina",code:"SC"},46:{name:"South Dakota",code:"SD"},47:{name:"Tennessee",code:"TN"},48:{name:"Texas",code:"TX"},49:{name:"Utah",code:"UT"},50:{name:"Vermont",code:"VT"},51:{name:"Virginia",code:"VA"},53:{name:"Washington",code:"WA"},54:{name:"West Virginia",code:"WV"},55:{name:"Wisconsin",code:"WI"},56:{name:"Wyoming",code:"WY"}},o=[{specialty_code:"0",specialty_name:"All Specialties"},{specialty_code:"1",specialty_name:"Allergy/Immunology"},{specialty_code:"2",specialty_name:"Cardiology"},{specialty_code:"3",specialty_name:"Endocrinology"},{specialty_code:"4",specialty_name:"Gastroenterology"},{specialty_code:"5",specialty_name:"Infectious disease"},{specialty_code:"6",specialty_name:"Nephrology"},{specialty_code:"7",specialty_name:"Neurology"},{specialty_code:"8",specialty_name:"Oncology"},{specialty_code:"9",specialty_name:"Pulmonology"},{specialty_code:"10",specialty_name:"Rheumatology"},{specialty_code:"11",specialty_name:"Surgery"},{specialty_code:"12",specialty_name:"Neurological Surgery"},{specialty_code:"13",specialty_name:"Ophthalmology"},{specialty_code:"14",specialty_name:"Orthopedic Surgery"},{specialty_code:"15",specialty_name:"Otorhinolaryngology"},{specialty_code:"16",specialty_name:"Plastic Surgery"},{specialty_code:"17",specialty_name:"Thoracic Surgery"},{specialty_code:"18",specialty_name:"Urology"},{specialty_code:"19",specialty_name:"Family Medicine"},{specialty_code:"20",specialty_name:"Internal Medicine"},{specialty_code:"21",specialty_name:"Geriatrics"},{specialty_code:"22",specialty_name:"General Pediatrics"},{specialty_code:"23",specialty_name:"Pediatric Non-Surgical Specialties"},{specialty_code:"24",specialty_name:"Pediatric Surgical Specialties"},{specialty_code:"25",specialty_name:"Anesthesiology"},{specialty_code:"26",specialty_name:"Dermatology"},{specialty_code:"27",specialty_name:"Emergency Medicine"},{specialty_code:"28",specialty_name:"Gynecology/Obstetrics"},{specialty_code:"29",specialty_name:"Pathology"},{specialty_code:"30",specialty_name:"Physical Medicine and Rehabilitation"},{specialty_code:"31",specialty_name:"Psychiatry"},{specialty_code:"32",specialty_name:"Preventive Medicine"},{specialty_code:"33",specialty_name:"Radiology"},{specialty_code:"34",specialty_name:"Non-Patient Care"},{specialty_code:"35",specialty_name:"Other Physician Specialty"}],r=d3.map(o,function(e){return e.specialty_code}),p=function(){var e={stateID:37,calculation:"netToAll",specialtyCode:0,physicianCode:2,data:[],legendData:[]};return e.specialtyName=r.get(e.specialtyCode).specialty_name,e.stateName=l[e.stateID].name,e.statePostalCode=l[e.stateID].code,e.ieVersion=t(),e.colorScale=d3.scaleThreshold(),e.loadData=function(){d3.queue().defer(d3.json,"datacontroller.php/?specialty="+e.specialtyCode+"&physician="+e.physicianCode+"&state="+e.stateID+"&calculation="+e.calculation).defer(d3.json,"legendcontroller.php/?specialty="+e.specialtyCode+"&physician="+e.physicianCode+"&calculation="+e.calculation).await(function(t,a,n){a.forEach(function(t){t.measure="net"==e.calculation||"netToAll"==e.calculation?+t.measure/10:+t.measure,t.stateID=t.state,t.stateName=l[t.state].name,t.statePostalCode=l[t.state].code}),e.data=a,e.legendData=n,1==e.physicianCode?"net"==e.calculation?(e.legendData.median=0,e.legendData.max=100,e.legendData.min=-100):"netToAll"==e.calculation&&(e.legendData.median=0,e.legendData.max=800,e.legendData.min=-800):2==e.physicianCode&&("net"==e.calculation?(e.legendData.median=0,e.legendData.max=100,e.legendData.min=-100):"netToAll"==e.calculation&&(e.legendData.median=0,e.legendData.max=800,e.legendData.min=-800)),c.call("dataReady",this,e)})},e.changePhysicianCode=function(t){e.physicianCode=+t,e.loadData()},e.changeSpecialtyCode=function(t){e.specialtyCode=+t,e.specialtyName=r.get(e.specialtyCode).specialty_name,e.loadData()},e.changeCalculation=function(t){e.calculation=t,"net"!=t&&"netToAll"!=t&&"retention"!=t||e.changeSpecialtyCode(0),e.loadData()},e.changeUSState=function(t){"retention"!=e.calculation&&"netToAll"!=e.calculation&&(e.stateID=+t,e.stateName=l[e.stateID].name,e.statePostalCode=l[e.stateID].code,e.loadData())},e.updateColorScale=function(){var t=+e.legendData.median,a=+e.legendData.max,n=+e.legendData.min,s=Math.min((t-n)/2,(a-t)/2),i=[t-s,t,t+s],l=["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"];e.colorScale.domain(i),l="import"==e.calculation?["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"]:"export"==e.calculation?["#feedde","#fdbe85","#fd8d3c","#d94701"]:"net"==e.calculation||"netToAll"==e.calculation?["#e66101","#fdb863","#b2abd2","#5e3c99"]:["#edf8e9","#bae4b3","#74c476","#238b45"],e.colorScale.range(l),c.call("colorScaleReady",this,e.colorScale)},e}(),d=function(){p.ieVersion<=11&&p.ieVersion>0&&(d3.select("#mapsvg").attr("height",650).attr("width",960).attr("class",""),d3.select("#us-map").attr("class","u-full-width"));return d3.select(".state"+p.stateID).classed("selectedState",!0),d3.selectAll(".usstate").append("title").text(function(){return this.parentNode.id.slice(5,7)}),function(){var e=d3.map(p.data,function(e){return i(e.state)}),t=d3.selectAll(".usstate").style("opacity",1);t.transition().duration(1e3).attr("fill",function(){var t,a="#ffffff";return 0!=(t="net"==p.calculation||"netToAll"==p.calculation?e.get(this.className.baseVal.slice(5,7)).count:e.get(this.className.baseVal.slice(5,7)).measure)&&(a=p.colorScale(t)),a});var n=d3.format(",");t.selectAll("title").text(function(t){var s=this.parentNode.className.baseVal.slice(5,7),c=e.get(s).count;return s==p.stateID&&"retention"!=p.calculation&&"netToAll"!=p.calculation?p.stateName:a(l[+s].name,c,n)}),d3.selectAll(".usstate").classed("selectedState",!1),"retention"!=p.calculation&&"netToAll"!=p.calculation?(d3.select("#mapsvg").selectAll(".state"+i(p.stateID)).classed("selectedState",!0),d3.select(".state-click-prompt").style("visibility","visible")):d3.select(".state-click-prompt").style("visibility","hidden")}}(),h=function(){var e=d3.select("#mapsvg").append("g").attr("class","key").attr("transform","translate(-70,615)");e.append("text").attr("class","caption").attr("transform","translate(560,-5)");e.append("g").attr("class","xAxis");return function(){var t=p.colorScale.domain(),a=[560,900],n=d3.scaleLinear().domain([0,d3.max(t)]).range([a[0],a[1]]),s=t,c=d3.format(",");"net"==p.calculation?(s.unshift("Net Outflow"),s.push("Net Inflow")):"netToAll"==p.calculation?(s.unshift("Net Exporter"),s.push("Net Importer")):(s=s.map(function(e){return e/100}),c=d3.format(".2p"));var i=d3.axisBottom(n).tickSize(13).tickValues(s).tickFormat(c),l=(a[1]-a[0])/p.colorScale.range().length;d3.select(".xAxis").call(i),d3.selectAll(".tick").each(function(e,t){if("net"==p.calculation||"netToAll"==p.calculation)a=n.range()[0]+l*t,d3.select(this).attr("transform","translate("+a+",0)"),0!=t&&t!=s.length-1||d3.select(this).select("text").text(s[t]);else{var a=n.range()[0]+l*(t+1);d3.select(this).attr("transform","translate("+a+",0)")}});var o=e.selectAll("rect").data(p.colorScale.range(),function(e){return e});o.enter().append("rect").attr("height",8).attr("x",function(e,t){return n.range()[0]+l*t}).attr("width",function(e){return l}).attr("fill",function(e){return e}),o.attr("x",function(e,t){return n.range()[0]+l*t}),o.exit().remove();var r="Percent of Physicians";r=1==p.physicianCode?"import"==p.calculation?"Percent of Physicians Imported to "+p.stateName:"export"==p.calculation?"Percent of Residents Exported from "+p.stateName:"net"==p.calculation?"Net Migration for "+p.stateName:"netToAll"==p.calculation?"Net Migration for Each State":"Percent of Residents Retained by Each State":"import"==p.calculation?"Percent of Physicians Imported to "+p.stateName:"export"==p.calculation?"Percent of Physicians Exported from "+p.stateName:"net"==p.calculation?"Net Migration for "+p.stateName:"netToAll"==p.calculation?"Net Migration for Each State":"Percent of Physicians Retained by Each State",d3.select(".caption").text(r)}}(),m=function(){function e(){var e=d3.select(".mainGroup").selectAll(".bar").data(f,function(e){return e.statePostalCode});e.attr("height",function(e){return Math.abs(o(e[w])-o(0))}).attr("y",function(e){return o(Math.max(e[w],0))}).attr("x",function(e,t){return c(e.statePostalCode)}).attr("width",c.bandwidth()).style("fill",function(e){return p.colorScale(e[w])}).select("title").text(function(e){return x(e[w])}),e.enter().append("rect").attr("class",function(e){return"state"+i(e.stateID)+" bar"}).style("fill",function(e){return p.colorScale(e[w])}).attr("y",function(e){return o(Math.max(e[w],0))}).attr("height",function(e){return Math.abs(o(e[w])-o(0))}).attr("x",function(e,t){return c(e.statePostalCode)}).attr("width",c.bandwidth()).on("click",function(e){"retention"!=p.calculation&&"netToAll"!=p.calculation&&(d3.select(this).style("fill","#d3d3d3"),p.changeUSState(e.stateID))}).on("mouseover",function(){var e=this.className.baseVal.slice(0,7);d3.select("#mapsvg").selectAll("."+e).style("stroke-width","3px"),d3.select("#chart").selectAll("."+e).style("stroke-width","2px").style("stroke","#000")}).on("mouseout",function(){var e=this.className.baseVal.slice(0,7);d3.select("#mapsvg").selectAll("."+e).style("stroke-width","1px"),d3.select("#chart").selectAll("."+e).style("stroke-width","0px").style("stroke","#fff")}).append("title").text(function(e){return x(e[w])}),e.exit().remove()}function t(){var e=d3.mouse(this),t=d3.brushSelection(d3.select(".brush").node()),a=t[1]-t[0],c=l.range(),i=d3.min(c)+a/2,o=d3.max(c)+l.bandwidth()-a/2,r=Math.min(o,Math.max(i,e[0]));d3.event.stopPropagation(),n.call(s.move,[r-a/2,r+a/2])}var a,n,s,c,l,o,r,d,h,m,g,u,y,f,x,w,v={top:10,right:10,bottom:20,left:50},b=400-v.left-v.right;u=220-v.top-v.bottom;var N={top:10,right:10,bottom:20,left:50},A=100-N.top-N.bottom;g=400-N.left-N.right,a=d3.select("#chart").append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+(b+v.left+v.right)+" "+(u+v.bottom+v.top+A+N.bottom+N.top)),p.ieVersion<=11&&p.ieVersion>0?(a.attr("height",u+v.bottom+v.top+A+N.bottom+N.top).attr("width",b+v.left+v.right),d3.select("#chart").attr("class","six columns")):a.attr("class","svgWrapper svg-content-responsive");var _=a.append("g").attr("class","mainGroupWrapper").attr("transform","translate("+v.left+","+(A+N.top+N.bottom+v.top)+")").append("g").attr("clip-path","url(#clip)").style("clip-path","url(#clip)").attr("class","mainGroup");a.append("g").attr("class","miniGroup").attr("transform","translate("+N.left+","+N.top+")"),a.append("g").attr("class","brushGroup").attr("transform","translate("+N.left+","+N.top+")");return o=d3.scaleLinear().range([u,0]),r=d3.scaleLinear().range([0,A]),c=d3.scaleBand().range([0,b]).paddingInner(.2).paddingOuter(0),l=d3.scaleBand().range([0,g]).paddingInner(.2).paddingOuter(0),d=d3.scaleLinear().range([0,b]).domain([0,b]),d3.select(".mainGroupWrapper").append("text").attr("transform","translate(0 ,-10)").classed("chart-title",!0).style("font-weight",600).style("font-size","12px").text("Chart title"),m=d3.axisLeft().scale(o).ticks(4).tickSizeOuter(0),d3.select(".mainGroupWrapper").append("g").attr("class","y axis").attr("transform","translate(-4,0)"),h=d3.axisBottom().scale(c).tickSize(0).tickSizeOuter(0),_.append("g").attr("class","x axis").attr("transform","translate(0,"+u+")"),s=d3.brushX().extent([[0,0],[g,A]]).on("start brush end",function(){var t=d3.event.selection,a=d.range();d.domain(t),c.range([d(a[0]),d(a[1])]).paddingInner(.2).paddingOuter(0),d3.select(".mainGroup").select(".x.axis").call(h);var n=l.domain().filter(function(e){return t[0]-l.bandwidth()+.01<=l(e)&&l(e)<=t[1]-.01});d3.selectAll(".x.axis.tick text").style("font-size",y(n.length)),e()}),(n=d3.select(".brushGroup").append("g").attr("class","brush").call(s)).selectAll("rect").attr("height",A),n.select(".overlay").on("mousedown.brush",t).on("touchstart.brush",t),a.append("defs").append("clipPath").attr("id","clip").append("rect").attr("y",0).attr("width",b).attr("height",u+v.bottom),y=d3.scaleLinear().domain([15,50]).range([12,6]).clamp(!0),function(){if(f=p.data,"retention"!=p.calculation&&"netToAll"!=p.calculation&&(f=f.filter(function(e){return e.state!=p.stateID})),w="net"==p.calculation||"netToAll"==p.calculation?"count":"measure",f.sort(function(e,t){return t[w]-e[w]}),"net"==p.calculation||"netToAll"==p.calculation){var e=d3.max(f,function(e){return Math.abs(e[w])});o.domain([-e,e]),r.domain([-e,e]),x=d3.format(",")}else o.domain([0,d3.max(f,function(e){return e[w]})]),r.domain([0,d3.max(f,function(e){return e[w]})]),x=function(e){return d3.format(".2p")(e/100)};m=m.scale(o),c.domain(f.map(function(e){return e.statePostalCode})),l.domain(f.map(function(e){return e.statePostalCode}));var t="Percent of Physicians";t=1==p.physicianCode?"import"==p.calculation?"Percent of Physicians Imported to "+p.stateName:"export"==p.calculation?"Percent of Residents Exported from "+p.stateName:"net"==p.calculation?"Net Migration for "+p.stateName:"netToAll"==p.calculation?"Net Migration for Each State":"Percent of Residents Retained by Each State":"import"==p.calculation?"Percent of Physicians Imported to "+p.stateName:"export"==p.calculation?"Percent of Physicians Exported from "+p.stateName:"net"==p.calculation?"Net Migration for "+p.stateName:"netToAll"==p.calculation?"Net Migration for Each State":"Percent of Physicians Retained by Each State",d3.select(".chart-title").text(t),m.tickFormat(x),d3.select(".mainGroup").select(".x.axis").call(h),d3.select(".mainGroupWrapper").select(".y.axis").call(m);var a=d3.select(".miniGroup").selectAll(".bar").data(f,function(e){return e.statePostalCode});a.transition().duration(1e3).attr("y",function(e){return A-r(Math.max(e[w],0))}).attr("height",function(e){return Math.abs(r(e[w])-r(0))}).attr("x",function(e,t){return l(e.statePostalCode)}).attr("width",l.bandwidth()).style("fill",function(e){return p.colorScale(e[w])}),a.enter().append("rect").attr("class",function(e){return"state"+i(e.stateID)+" bar"}).attr("y",function(e){return A-r(Math.max(e[w],0))}).attr("height",function(e){return Math.abs(r(e[w])-r(0))}).attr("x",function(e,t){return l(e.statePostalCode)}).attr("width",l.bandwidth()).style("fill",function(e){return p.colorScale(e[w])}).on("mouseover",function(){var e=this.className.baseVal.slice(0,7);d3.select("#mapsvg").selectAll("."+e).style("stroke-width","3px"),d3.select("#chart").selectAll("."+e).style("stroke-width","2px").style("stroke","#000")}).on("mouseout",function(){var e=this.className.baseVal.slice(0,7);d3.select("#mapsvg").selectAll("."+e).style("stroke-width","1px"),d3.select("#chart").selectAll("."+e).style("stroke-width","0px").style("stroke","#fff")}),a.exit().remove(),n.call(s.move,d3.brushSelection(d3.select(".brush").node())||[0,100])}}();!function(){o.sort(function(e,t){var a=e.specialty_name.toUpperCase(),n=t.specialty_name.toUpperCase();return a<n?-1:a>n?1:0});for(var e=document.getElementById("specialties"),t=o.length,a=0;a<t;a++){var n=o[a].specialty_name,s=o[a].specialty_code,c=document.createElement("option");c.textContent=n,c.value=s,e.appendChild(c)}"net"!=p.calculation&&"netToAll"!=p.calculation&&"retention"!=p.calculation||d3.select("#specialties").selectAll("option").each(function(){0==this.value?this.selected=!0:(this.disabled=!0,this.hidden=!0)});var i=100;d3.selectAll(".info-icon").on("click",function(e,t){d3.selectAll(".explanation").style("display","none"),d3.selectAll(".info-icon").style("fill","#000000"),t==i?i=100:(d3.select(this).style("fill","#c3c3c3"),2==t?d3.select("#explainSpecialty").style("opacity",0).style("display","block").transition().duration(500).style("opacity",1):1==t?d3.select("#explainCalculation").style("opacity",0).style("display","block").transition().duration(500).style("opacity",1):0==t?d3.select("#explainResidentYesNo").style("opacity",0).style("display","block").transition().duration(500).style("opacity",1):d3.selectAll(".explanation").style("display","none"),i=t)})}(),c.on("dataReady",function(e){p.updateColorScale()}),c.on("colorScaleReady",function(){d(),h(),m(),n()}),d3.selectAll("input").on("change",function(){p.changePhysicianCode(this.value)}).property("checked",function(e){return this.value==p.physicianCode}),d3.select("#specialties").on("change",function(){p.changeSpecialtyCode(this.value)}).property("value",p.specialtyCode),d3.select("#calculations").on("change",function(){var e=this.value;"net"!=e&&"netToAll"!=e&&"retention"!=e?(d3.select("#specialties").selectAll("option").property("disabled",!1),d3.select("#specialties").selectAll("option").property("hidden",!1)):d3.select("#specialties").selectAll("option").each(function(){0==this.value?this.selected=!0:(this.disabled=!0,this.hidden=!0)}),p.changeCalculation(e)}).property("value",p.calculation),d3.selectAll(".usstate").on("click",function(e){var t=this.className.baseVal.slice(5,7);"retention"!=p.calculation&&"netToAll"!=p.calculation&&(d3.selectAll(".usstate").classed("selectedState",!1),d3.select("#mapsvg").selectAll(".state"+i(t)).classed("selectedState",!0)),p.changeUSState(t)}).on("mouseover",function(){var e=this.className.baseVal.slice(0,7);d3.select("#mapsvg").selectAll("."+e).style("stroke-width","3px"),d3.select("#chart").selectAll("."+e).style("stroke-width","2px").style("stroke","#000")}).on("mouseout",function(){var e=this.className.baseVal.slice(0,7);d3.select("#mapsvg").selectAll("."+e).style("stroke-width","1px"),d3.select("#chart").selectAll("."+e).style("stroke-width","0px").style("stroke","#fff")}),p.ieVersion<=11&&p.ieVersion>0&&d3.selectAll(".save-image").style("display","none"),d3.selectAll(".save-image").on("click",function(){var t=document.getElementById("mapsvg").cloneNode(!0),a=d3.select("#help-box").text().split("chart show"),n=d3.select("#map-title").text(),s=d3.select("#note").text();a=(a=(a="The current map shows"+a[1]).replace(/For instance/i," For instance")).replace(/and charted /i,"");var c=d3.select(t).attr("viewBox","0 0 1000 800");c.selectAll("path").attr("transform","translate(20,50)"),c.selectAll(".stateSquares").attr("transform","translate(20,50)"),c.select(".key").attr("transform","translate(0,650)"),c.select(".state-click-prompt").attr("display","none"),c.append("text").attr("y",40).attr("x",500).attr("text-anchor","middle").attr("font-size","25").attr("font-weight","700").text(n);c.append("text").attr("y",765).attr("x",500).attr("font-size","8").text(s).call(e,140),c.append("text").attr("y",660).attr("x",30).attr("font-size","14").text(a).call(e,80);c.append("text").attr("y",720).attr("x",500).attr("font-size","25").attr("font-weight","700").style("fill","#4B9CD3").text("Carolina Health Workforce Research Center"),c.append("text").attr("y",740).attr("x",745).attr("font-size","14").attr("text-anchor","middle").text("docflows.unc.edu | www.healthworkforce.unc.edu"),saveSvgAsPng(c.node(),"viz.png",{backgroundColor:"#fff"})}),p.loadData()}();
